p8105_hw5_zj2379
================
Zheshu Jiang
2023-11-12

## Problem 1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
# Create a city_state variable
homicide_df = read.csv("./homicide-data.csv")|>
 mutate(city_state = paste(city, state, sep = ", "))

#summarize within cities to obtain the total number of homicides and the number of unsolved homicides 
homicide_df1=homicide_df |>
  group_by (city) |>
  summarize(total_homicides=n(),
            unsolved_homicides=sum(disposition %in% c("Closed without arrest","Closed by arrest")))
homicide_df1
```

    ## # A tibble: 50 × 3
    ##    city        total_homicides unsolved_homicides
    ##    <chr>                 <int>              <int>
    ##  1 Albuquerque             378                284
    ##  2 Atlanta                 973                658
    ##  3 Baltimore              2827               1154
    ##  4 Baton Rouge             424                244
    ##  5 Birmingham              800                517
    ##  6 Boston                  614                304
    ##  7 Buffalo                 521                210
    ##  8 Charlotte               687                525
    ##  9 Chicago                5535               1849
    ## 10 Cincinnati              694                434
    ## # ℹ 40 more rows

For the city of Baltimore, MD, use the prop.test function to estimate
the proportion of homicides that are unsolved; save the output of
prop.test as an R object, apply the broom::tidy to this object and pull
the estimated proportion and confidence intervals from the resulting
tidy dataframe.

``` r
baltimore_homicides <- homicide_df %>%
  filter(city == "Baltimore", state == "MD")

# Use prop.test to estimate the proportion of unsolved homicides
unsolved_homicides <- sum(baltimore_homicides$disposition %in% c("Closed without arrest", "Open/No arrest"))
total_homicides <- nrow(baltimore_homicides)

prop_test_result <- prop.test(unsolved_homicides, total_homicides)

# Tidy the result of prop.test using broom::tidy
tidy_prop_test <- broom::tidy(prop_test_result)

# Pull the estimate and confidence intervals
tidy_estimate_ci <- tidy_prop_test %>%
  select(estimate, conf.low, conf.high) %>%
  pull()
```

``` r
# Create a summary dataframe with counts of unsolved and total homicides by city
city_summary <- homicide_df %>%
  group_by(city, state) %>%
  summarise(
    unsolved_homicides = sum(disposition %in% c("Closed without arrest", "Open/No arrest")),
    total_homicides = n(),
    .groups = "drop"
  )

# Use purrr to apply prop.test to each city and tidy the results
tidy_prop_test_results <- city_summary %>%
  mutate(
    prop_test = map2(unsolved_homicides, total_homicides, ~prop.test(.x, .y)),
    tidy_results = map(prop_test, broom::tidy)
  ) %>%
  select(city, state, tidy_results) %>%
  unnest(tidy_results)
```

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `prop_test = map2(unsolved_homicides, total_homicides,
    ##   ~prop.test(.x, .y))`.
    ## Caused by warning in `prop.test()`:
    ## ! Chi-squared approximation may be incorrect

``` r
tidy_proportions_ci <- tidy_prop_test_results %>%
  select(city, state, estimate, conf.low, conf.high)
tidy_proportions_ci
```

    ## # A tibble: 51 × 5
    ##    city        state estimate conf.low conf.high
    ##    <chr>       <chr>    <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque NM       0.386    0.337     0.438
    ##  2 Atlanta     GA       0.383    0.353     0.415
    ##  3 Baltimore   MD       0.646    0.628     0.663
    ##  4 Baton Rouge LA       0.462    0.414     0.511
    ##  5 Birmingham  AL       0.434    0.399     0.469
    ##  6 Boston      MA       0.505    0.465     0.545
    ##  7 Buffalo     NY       0.612    0.569     0.654
    ##  8 Charlotte   NC       0.300    0.266     0.336
    ##  9 Chicago     IL       0.736    0.724     0.747
    ## 10 Cincinnati  OH       0.445    0.408     0.483
    ## # ℹ 41 more rows

``` r
tidy_proportions_ci <- tidy_proportions_ci %>%
  arrange(desc(estimate))
plot <- ggplot(tidy_proportions_ci, aes(x = reorder(city, estimate), y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
  coord_flip() +  # Flip the axes to make the plot horizontal
  labs(x = "City", y = "Proportion of Unsolved Homicides", title = "Proportion of Unsolved Homicides by City") +
  theme_minimal()

ggsave(filename = "unsolved_homicides_by_city.png", plot = plot, width = 10, height = 8, dpi = 300)
```
